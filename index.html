<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shorts Combiner â€¢ FFmpeg.wasm</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f1724;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 20px;
    }
    h1 {
      color: #1976d2;
    }
    input, button {
      padding: 10px;
      margin: 10px;
      font-size: 1rem;
      border-radius: 5px;
      border: none;
    }
    button {
      background-color: #1976d2;
      color: #fff;
      cursor: pointer;
    }
    button:disabled {
      background-color: #555;
      cursor: not-allowed;
    }
    video {
      margin-top: 20px;
      max-width: 100%;
      border: 2px solid #1976d2;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>Shorts Combiner (FFmpeg.wasm)</h1>

  <input type="file" id="files" multiple accept="video/*" />
  <button id="combineBtn">Combine Videos</button>

  <video id="outputVideo" controls></video>

  <script type="module">
    import { createFFmpeg, fetchFile } from './ffmpeg.min.js';

    const ffmpeg = createFFmpeg({
      log: true,
      corePath: './ffmpeg-core.wasm' // adjust if wasm is inside ffmpeg-core folder
    });

    const combineBtn = document.getElementById('combineBtn');
    const filesInput = document.getElementById('files');
    const outputVideo = document.getElementById('outputVideo');

    combineBtn.addEventListener('click', async () => {
      if (filesInput.files.length === 0) {
        alert('Please select some video files first.');
        return;
      }

      combineBtn.disabled = true;
      combineBtn.textContent = 'Loading FFmpeg...';

      if (!ffmpeg.isLoaded()) await ffmpeg.load();

      combineBtn.textContent = 'Combining videos...';

      // Write files to FFmpeg FS
      for (let i = 0; i < filesInput.files.length; i++) {
        ffmpeg.FS('writeFile', `input${i}.mp4`, await fetchFile(filesInput.files[i]));
      }

      // Create a text file listing inputs for concat
      let listTxt = '';
      for (let i = 0; i < filesInput.files.length; i++) {
        listTxt += `file 'input${i}.mp4'\n`;
      }
      ffmpeg.FS('writeFile', 'fileList.txt', listTxt);

      // Run FFmpeg concat command
      await ffmpeg.run('-f', 'concat', '-safe', '0', '-i', 'fileList.txt', '-c', 'copy', 'output.mp4');

      // Read output and display
      const data = ffmpeg.FS('readFile', 'output.mp4');
      const videoBlob = new Blob([data.buffer], { type: 'video/mp4' });
      outputVideo.src = URL.createObjectURL(videoBlob);

      combineBtn.disabled = false;
      combineBtn.textContent = 'Combine Videos';
    });
  </script>
</body>
</html>

